<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/ILogow.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/iam.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/iam.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/ILogo.png?v=5.1.4" color="#222">





  <meta name="keywords" content="Java,源码,spring,">










<meta name="description" content="概述本章节主要对之前简单介绍过的 IOC 容器进行详细的补充，包括IOC容器的实现原理和使用配置，其中主要介绍对象的创建的过程的历程，讲述从一开始的高耦合的创建方式，如何到Spring中的注解配置方式。">
<meta name="keywords" content="Java,源码,spring">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring 对象管理">
<meta property="og:url" content="http://littlexiaotimpro.github.io/2020/08/25/Spring_Framework_IOC/index.html">
<meta property="og:site_name" content="Wiki&#39;s Blog">
<meta property="og:description" content="概述本章节主要对之前简单介绍过的 IOC 容器进行详细的补充，包括IOC容器的实现原理和使用配置，其中主要介绍对象的创建的过程的历程，讲述从一开始的高耦合的创建方式，如何到Spring中的注解配置方式。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://littlexiaotimpro.github.io/images/aop-exception.PNG">
<meta property="og:updated_time" content="2020-08-24T16:00:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring 对象管理">
<meta name="twitter:description" content="概述本章节主要对之前简单介绍过的 IOC 容器进行详细的补充，包括IOC容器的实现原理和使用配置，其中主要介绍对象的创建的过程的历程，讲述从一开始的高耦合的创建方式，如何到Spring中的注解配置方式。">
<meta name="twitter:image" content="http://littlexiaotimpro.github.io/images/aop-exception.PNG">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://littlexiaotimpro.github.io/2020/08/25/Spring_Framework_IOC/">





  <title>Spring 对象管理 | Wiki's Blog</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <!-- 
    <a href="https://github.com/littlexiaotimpro/littlexiaotimpro.github.io" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    -->
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wiki's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            日程表
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://littlexiaotimpro.github.io/2020/08/25/Spring_Framework_IOC/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wiki">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/ILogo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wiki's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Spring 对象管理</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-25T00:00:00+08:00">
                2020-08-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/notebook/" itemprop="url" rel="index">
                    <span itemprop="name">notebook</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本章节主要对之前简单介绍过的 IOC 容器进行详细的补充，包括IOC容器的实现原理和使用配置，其中主要介绍对象的创建的过程的历程，讲述从一开始的高耦合的创建方式，如何到Spring中的注解配置方式。<br><a id="more"></a></p>
<h2 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h2><p>控制反转（Inversion of Control，缩写为 IOC），是程序设计的一种重要思想，将传统意义上的对象之间的依赖交由容器统一管理，虽说不能完全消除对象间的耦合度，但极大程度的减少了其依赖性。</p>
<p>常用的实现方式：</p>
<ul>
<li>依赖注入（Dependency Injection，简称 DI）<br>实现方式有：XML 解析，工厂模式，反射</li>
<li>依赖查找（Dependency Lookup，简称 DL）</li>
</ul>
<p>控制反转反转了哪方面的控制？</p>
<p>主要实现了对象创建即获取方式的反转，程序设计中，客户端获取对象是通过自己主动的方式，去创建需要的对象，若某一天对象类修改了或不需要了，那么需要修改的地方就会非常的繁琐，而IOC容器的思想，是将对象的创建及管理全部交由容器处理，客户端只需要注入所需的资源即可。</p>
<h3 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h3><p>将对象的属性从原有的手动注入模式，变为从外部注入的实现方式，减少对象间的耦合，最常用的是在对象内部存在关联的其它对象属性时，可以通过setter方式或带参数的构造器等方式实现属性赋值。</p>
<p>依赖注入主要分为两个步骤：</p>
<ul>
<li>对象创建</li>
<li>属性注入<br>基本属性注入，内置关联对象属性注入【其它实体/接口、集合、……】</li>
</ul>
<h4 id="XML-文件解析"><a href="#XML-文件解析" class="headerlink" title="XML 文件解析"></a>XML 文件解析</h4><p>使用 XML 配置文件，实现Bean的对象创建及属性注入：</p>
<ul>
<li>属性注入分为，<code>setter</code> 注入，构造器注入，命名空间注入等</li>
<li>Bean对象的内置对象又分为内置Bean，外置Bean，级联赋值</li>
</ul>
<p>如下是XML 文件的基础配置，在内部定义 beans 的子标签实现对象的创建及属性注入。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- bean definitions here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>XML 配置的注入方式需要使用的几个关键的类，如下：</p>
<ul>
<li><code>XmlServletWebServerApplicationContext</code><br>需要配置ServletWeb服务器，在服务器路径下加载xml配置文件</li>
<li><code>FileSystemXmlApplicationContext</code><br>从项目根目录下获取xml配置文件，如果使用此类加载classpath目录下的配置文件或项目目录下不存在的配置文件，会报错，<br>IOException parsing XML document from file [项目根路径\config.xml]，FileNotFoundException<br>原因为在项目目录下没找到对应的配置文件</li>
<li><code>ClassPathXmlApplicationContext</code><br>从项目编译目录下加载xml配置，Spring项目的配置文件一般放在resources资源文件夹下，项目编译或启动时会自动加载，这也是测试时主要使用的实现类。</li>
</ul>
<h3 id="XML-实现对象管理"><a href="#XML-实现对象管理" class="headerlink" title="XML 实现对象管理"></a>XML 实现对象管理</h3><p>XML 对象管理一般分为两步，创建对象和属性注入，XML 配置不仅可以实现对象的创建及管理，还能通过配置不同的命名空间，实现对象的自动注入等。</p>
<p>XML 对象管理的基本属性：</p>
<ul>
<li><code>&lt;bean&gt;</code><br>id：对象的唯一标识，class：对象的全限定类名，scope：创建的对象的作用域，singleton单例对象，prototype多实例对象</li>
<li><code>&lt;property&gt;</code><br>name：属性名称，value：属性值，用于基本数据类型及其包装类、字符串类型的赋值，ref：引用对象（第一步方式创建的对象）</li>
<li><code>&lt;list&gt;</code>、<code>&lt;array&gt;</code><br><code>&lt;value&gt;</code> 标签用于基本数据类型及其包装类、字符串类型的赋值，<code>&lt;ref&gt;</code> 子标签用于引用对象</li>
<li><code>&lt;map&gt;</code><br><code>&lt;entry&gt;</code> 子标签标识一个节点值，key（key-ref）和 value（value-ref）属性表示键值对的数据</li>
</ul>
<h4 id="基础的Bean创建"><a href="#基础的Bean创建" class="headerlink" title="基础的Bean创建"></a>基础的Bean创建</h4><p>创建Bean的基本配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.基础的对象创建 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>实体Bean:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String demoCode;</span><br><span class="line">    <span class="keyword">private</span> String demoString;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDemoCode</span><span class="params">(String demoCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.demoCode = demoCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDemoString</span><span class="params">(String demoString)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.demoString = demoString;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意，在执行 <code>new ClassPathXmlApplicationContext(&quot;bean-config.xml&quot;)</code> 时就已经将资源加载进容器中了，容器会对已经创建的对象进行统一管理，通过 <code>getBean</code> 的方式可以获取实例，传入参数可以时实例类型，或者是对象实例的名称。</p>
<p>简单的测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.通过资源文件获取实现，解析 XML 配置文件</span></span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean-config.xml"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.调用getBean方法获取实例</span></span><br><span class="line">    <span class="comment">// 2.1 通过实例名称获取实例对象，demo为配置文件中配置的示例标识id</span></span><br><span class="line">    BeanDemo bean = context.getBean(<span class="string">"demo"</span>, BeanDemo.class);</span><br><span class="line">    System.out.println(bean); </span><br><span class="line">    <span class="comment">// class com.practice.entity.BeanDemo &#123;demoCode=null, demoString=null&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.2 通过实例类型获取实例对象</span></span><br><span class="line">    BeanDemo beanUnId = context.getBean(BeanDemo.class);</span><br><span class="line">    System.out.println(beanUnId);</span><br><span class="line">    <span class="comment">// class com.practice.entity.BeanDemo &#123;demoCode=null, demoString=null&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Bean的作用域及生命周期"><a href="#Bean的作用域及生命周期" class="headerlink" title="Bean的作用域及生命周期"></a>Bean的作用域及生命周期</h4><p>XML 配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- bean的作用域及生命周期 scope属性指定作用域，单例或多例--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    scope: singleton 单例, prototype 多例 </span></span><br><span class="line"><span class="comment">    init-method: 对象初始化执行的方法</span></span><br><span class="line"><span class="comment">    destroy-method: 对象销毁时执行的方法</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoScope"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemoScope"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span> <span class="attr">init-method</span>=<span class="string">"initInstance"</span> <span class="attr">destroy-method</span>=<span class="string">"destroyInstance"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"code"</span> <span class="attr">value</span>=<span class="string">"setter"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 创建Bean处理器对象，在对象创建的生命周期过程中，都会执行如下实现定义的初始化前后方法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"beanDemoPostProcessor"</span> <span class="attr">class</span>=<span class="string">"com.practice.processor.BeanDemoPostProcessor"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>Bean实体:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanDemoScope</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanDemoScope</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"1.调用无参构造器！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"2.调用setter方法！"</span>);</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"3.调用实例初始化方法！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">useInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"4.1.使用实例！code = "</span> + code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroyInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"5.调用实例销毁的方法！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Bean的作用域：</strong></p>
<ul>
<li>单实例<br>单实例对象在创建的过程中只会执行一次创建的过程，每一次从容器中获取的对象都是同一个</li>
<li>多实例<br>多实例，每一次获取都会重新构造实例，所以创建出来的是不同的实例</li>
</ul>
<p>作用域测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testScope</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean-config.xml"</span>);</span><br><span class="line">    BeanDemoScope beanScope = context.getBean(<span class="string">"demoScope"</span>, BeanDemoScope.class);</span><br><span class="line">    System.out.println(beanScope);</span><br><span class="line">    BeanDemoScope beanScope1 = context.getBean(<span class="string">"demoScope"</span>, BeanDemoScope.class);</span><br><span class="line">    System.out.println(beanScope1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如上的程序执行结果如下：</p>
<ul>
<li><p>单例对象：<br><code>&lt;bean id=&quot;demoScope&quot; class=&quot;com.practice.entity.BeanDemoScope&quot; scope=&quot;singleton&quot;/&gt;</code><br>获取的两个实例的地址是同一个：构造器只执行了一次<br>调用无参构造器！<br>com.practice.entity.BeanDemoScope@770c2e6b<br>com.practice.entity.BeanDemoScope@770c2e6b  </p>
</li>
<li><p>多例对象：<br><code>&lt;bean id=&quot;demoScope&quot; class=&quot;com.practice.entity.BeanDemoScope&quot; scope=&quot;prototype&quot;/&gt;</code><br>获取的两个实例的地址不同：构造器执行了多次<br>调用无参构造器！<br>com.practice.entity.BeanDemoScope@18a70f16<br>调用无参构造器！<br>com.practice.entity.BeanDemoScope@62e136d3  </p>
</li>
</ul>
<p><strong>Bean的生命周期：</strong></p>
<p>主要表示一个对象从创建到销毁的全过程，称之为对象的生命周期，一般分为对象创建、属性赋值、初始化、调用对象、销毁对象这几步，但是在程序中，对象初始化前后可以对对象再进一步的处理，如修改部分属性等。</p>
<p>生命周期的测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现Bean对象的后置处理接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanDemoPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实例初始化之前调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"初始化前执行的方法：Bean =&gt; "</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实例初始化之后调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"初始化后执行的方法：Bean =&gt; "</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBeanLife</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean-config.xml"</span>);</span><br><span class="line">    BeanDemoScope beanScope = context.getBean(<span class="string">"demoScope"</span>, BeanDemoScope.class);</span><br><span class="line">    System.out.println(<span class="string">"4.获取对象实例："</span> + beanScope);</span><br><span class="line">    beanScope.useInstance();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭容器，销毁实例对象</span></span><br><span class="line">    context.close();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 容器关闭后无法获取实例对象</span></span><br><span class="line">    <span class="comment">// java.lang.IllegalStateException: BeanFactory not initialized or already closed</span></span><br><span class="line">    <span class="comment">// - call 'refresh' before accessing beans via the ApplicationContext</span></span><br><span class="line">    <span class="comment">// 想要重新启用容器：先执行刷新方法</span></span><br><span class="line">    <span class="comment">// context.refresh();</span></span><br><span class="line">    <span class="comment">// context.getBean("demoScope", BeanDemoScope.class).useInstance();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行结果如下：</p>
<p>1.调用无参构造器！<br>2.调用setter方法！<br>BeanDemoPostProcessor::postProcessBeforeInitialization，初始化前执行的方法：Bean =&gt; demoScope<br>3.调用实例初始化方法！<br>BeanDemoPostProcessor::postProcessAfterInitialization，初始化后执行的方法：Bean =&gt; demoScope<br>4.获取对象实例：com.practice.entity.BeanDemoScope@12d3a4e9<br>4.1.使用实例！code = setter<br>5.调用实例销毁的方法！ </p>
<p>需要注意，5的结果，是在 <code>scope</code> 属性值为 <code>singleton</code> 时输出的，当他为多实例属性 <code>prototype</code> 时不输出。</p>
<h4 id="属性注入"><a href="#属性注入" class="headerlink" title="属性注入"></a>属性注入</h4><p>本小节主要介绍对象实例的属性注入，对象类型主要为基本数据类型及其包装类型、字符串、及其他引用类型。</p>
<p>在创建对象的时候，基本数据类型会赋上默认值，如 int 的默认值为 0，但引用数据类型需要通过初始化才能进行赋值，否则就是null。</p>
<p>XML 基本配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    property: 属性标签</span></span><br><span class="line"><span class="comment">    name: 对象的属性名称</span></span><br><span class="line"><span class="comment">    value: 类型基本数据类型及包装类、String的属性值</span></span><br><span class="line"><span class="comment">    ref: xml中配置的其他对象的id，用于外部Bean的注入</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">ref</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- p属性命名空间 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span> <span class="attr">p:demoCode</span>=<span class="string">"0001"</span> <span class="attr">p:demoString</span>=<span class="string">"code and string"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="Setter方式注入"><a href="#Setter方式注入" class="headerlink" title="Setter方式注入"></a>Setter方式注入</h5><p>为需要注入的属性提供 <code>Setter</code> 方法，XML 配置文件解析的时候会将对应的属性进行赋值。</p>
<p>XML 配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- setter方式注入属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"demoCode"</span> <span class="attr">value</span>=<span class="string">"0001"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"demoString"</span> <span class="attr">value</span>=<span class="string">"demoProperty"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSetter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.通过资源文件获取实现，解析 XML 配置文件</span></span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean-config.xml"</span>);</span><br><span class="line">    <span class="comment">// 2.调用getBean方法获取实例，demo为配置文件中配置的示例标识id</span></span><br><span class="line">    BeanDemo bean = context.getBean(<span class="string">"demo"</span>, BeanDemo.class);</span><br><span class="line">    <span class="comment">// 3.验证属性是否注入成功？</span></span><br><span class="line">    System.out.println(bean);</span><br><span class="line">    <span class="comment">// class com.practice.entity.BeanDemo &#123;demoCode=0001, demoString=demoProperty&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPNamespace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean-config.xml"</span>);</span><br><span class="line">    BeanDemo bean = context.getBean(<span class="string">"demo"</span>, BeanDemo.class);</span><br><span class="line">    <span class="comment">// class com.practice.entity.BeanDemo &#123;demoCode=0001, demoString=code and string, demoSize=null, demoBool=false&#125;</span></span><br><span class="line">    System.out.println(bean);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        在配置文件中配置了不提供setter方法的属性，提示如下</span></span><br><span class="line"><span class="comment">        BeanCreationException: Bean property 'demoCode' is not writable or has an invalid setter method.</span></span><br><span class="line"><span class="comment">        对象创建异常：没有具体属性提供setter方法，或setter方法设置有问题，导致无法识别</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如上，成功创建对象实例，并给实例中的属性注入了值。那么，对于定义了属性的类型，如果不提供setter方法，能否注入属性？</p>
<p>答：不能注入属性，在配置文件中配置了不提供setter方法的属性，会报错，提示 <code>BeanCreationException: Bean property &#39;demoCode&#39; is not writable or has an invalid setter method.</code> 即，对象创建异常：没有具体属性提供 setter 方法，或 setter 方法设置有问题，导致无法识别</p>
<p>需要注意，如果要通过 setter 方式注入属性，且配置文件配置了该属性，那么必须提供 setter，没配置的属性为 null 或为默认值（基本数据类型）<code>class com.practice.entity.BeanDemo {demoCode=0001, demoString=demoProperty, demoSize=null, demoBool=false}</code></p>
<h5 id="带参构造器注入"><a href="#带参构造器注入" class="headerlink" title="带参构造器注入"></a>带参构造器注入</h5><p>通过调用有参构造器创建对象，并给对应属性进行赋值。</p>
<p>XML 基本配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 构成器注入属性 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    constructor-arg: 构造器参数</span></span><br><span class="line"><span class="comment">    name: 对象的属性名称</span></span><br><span class="line"><span class="comment">    index: 参数的索引为，如 0 表示第一个参数，和 name 选其一使用即可</span></span><br><span class="line"><span class="comment">    value: 类型基本数据类型及包装类、String的属性值</span></span><br><span class="line"><span class="comment">    ref: xml中配置的其他对象的id，用于外部Bean的注入</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 带参构造器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">ref</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 定义了带参构造器之后，若不提供无参构造器，按基础的对象创建方式创建对象会报错，提示没有默认的构造器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoError"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>XML 配置测试：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 构成器注入属性 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 定义了带参构造器之后，若不提供无参构造器，按基础的对象创建方式创建对象会报错，提示没有默认的构造器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoError"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 带参构造器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"demoSize"</span> <span class="attr">value</span>=<span class="string">"100"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>实体Bean：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String demoCode;</span><br><span class="line">    <span class="keyword">private</span> String demoString;</span><br><span class="line">    <span class="keyword">private</span> Integer demoSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> demoBool;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 此处省略属性的Setter方法</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提供带参构造器，需要提供默认的无参构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanDemo</span><span class="params">(Integer demoSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.demoSize = demoSize;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConstructor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean-config.xml"</span>);</span><br><span class="line">    BeanDemo bean = context.getBean(<span class="string">"demo"</span>, BeanDemo.class);</span><br><span class="line">    <span class="comment">// class com.practice.entity.BeanDemo &#123;demoCode=null, demoString=null, demoSize=100, demoBool=false&#125;</span></span><br><span class="line">    System.out.println(bean);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        &lt;!-- 定义了带参构造器之后，若按基础的对象创建方式创建对象会报错，提示没有默认的构造器 --&gt;</span></span><br><span class="line"><span class="comment">//        &lt;!-- &lt;bean id="demoError" class="com.practice.entity.BeanDemo"/&gt;--&gt;</span></span><br><span class="line"><span class="comment">//        //  BeanCreationException：No default constructor found;</span></span><br><span class="line"><span class="comment">//        BeanDemo demoError = context.getBean("demoError", BeanDemo.class);</span></span><br><span class="line"><span class="comment">//        System.out.println(demoError);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="含特殊字符的值注入"><a href="#含特殊字符的值注入" class="headerlink" title="含特殊字符的值注入"></a>含特殊字符的值注入</h5><p>特殊字符注入对特殊字符进行转义，或者使用 <code>CDATA</code>（基本语法：<code>![CDATA[value]]</code>），通过转义之后可以进行正常的赋值：</p>
<table>
<thead>
<tr>
<th>转义字符</th>
<th>符号</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>\&amp;</td>
<td>&amp;</td>
<td>和</td>
</tr>
<tr>
<td>\&lt;</td>
<td>&lt;</td>
<td>左尖括号</td>
</tr>
<tr>
<td>\&gt;</td>
<td>&gt;</td>
<td>右尖括号</td>
</tr>
<tr>
<td>\&quot;</td>
<td>“</td>
<td>双引号</td>
</tr>
<tr>
<td>\&nbsp;</td>
<td></td>
<td>空格</td>
</tr>
</tbody>
</table>
<p>XML 配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注入特殊含特殊字符的值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"demoCode"</span> <span class="attr">value</span>=<span class="string">"&amp;lt;0001&amp;gt;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"demoString"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>&lt;![CDATA["&lt;带特殊字符的串&gt;"]]&gt;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSpecialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        若配置文件内容为：&lt;property name="demoCode" value="&lt;0001&gt;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">        加载配置文件是会提示异常，提示具体位置的配置存在特殊字符</span></span><br><span class="line"><span class="comment">        XmlBeanDefinitionStoreException：lineNumber: 34; columnNumber: 42; 与元素类型 "property" 相关联的 "value" 属性值不能包含 '&lt;' 字符。</span></span><br><span class="line"><span class="comment">        如果需要注入带特殊字符的值，则需要对字符进行转义，常用的xml转义字符 &amp;lt;&amp;gt;等，表示&lt;&gt;，分号结束表示一个字符实体</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean-config.xml"</span>);</span><br><span class="line">    BeanDemo bean = context.getBean(<span class="string">"demo"</span>, BeanDemo.class);</span><br><span class="line">    <span class="comment">// class com.practice.entity.BeanDemo &#123;demoCode=&lt;0001&gt;, demoString="&lt;带特殊字符的串&gt;", demoSize=null, demoBool=false&#125;</span></span><br><span class="line">    System.out.println(bean);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="数组或集合属性注入"><a href="#数组或集合属性注入" class="headerlink" title="数组或集合属性注入"></a>数组或集合属性注入</h5><p>XML 基本配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注入集合属性，数组属性 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    list: 集合属性，使用value表示可以直接赋值的数据类型</span></span><br><span class="line"><span class="comment">    set: 同list</span></span><br><span class="line"><span class="comment">    map: entry表示一个节点，可以设置key值及value值</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"demoArray"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>one<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>two<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"demoList"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>list_one<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>list_two<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"demoMap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key_one"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>map_one<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key_two"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>map_two<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>实体新增属性如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanDemo</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 注入字符串集合属性</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; demoList;</span><br><span class="line">    <span class="comment">// 注入字符串集合属性</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; demoMap;</span><br><span class="line">    <span class="comment">// 注入数组属性</span></span><br><span class="line">    <span class="keyword">private</span> String[] demoArray;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略Setter及构造器</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCollections</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.通过资源文件获取实现，解析 XML 配置文件</span></span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean-config.xml"</span>);</span><br><span class="line">    <span class="comment">// 2.调用getBean方法获取实例，demo为配置文件中配置的示例标识id</span></span><br><span class="line">    BeanDemo bean = context.getBean(<span class="string">"demo"</span>, BeanDemo.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注入数组/集合属性，同基本属性注入，需要实体提供对应属性的setter方法</span></span><br><span class="line">    <span class="comment">// 正确注入的展示结果</span></span><br><span class="line">    <span class="comment">// demoList=[list_one, list_two]</span></span><br><span class="line">    <span class="comment">// demoMap=&#123;key_one=map_one, key_two=map_two&#125;</span></span><br><span class="line">    <span class="comment">// demoArray=[one, two]</span></span><br><span class="line">    System.out.println(bean);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="对象属性注入"><a href="#对象属性注入" class="headerlink" title="对象属性注入"></a>对象属性注入</h5><p>对象属性注入分为如下几种方式：需要提供Setter方法，也可以通过构造器的方式注入</p>
<ul>
<li>内部 Bean<br>直接将 Bean 属性的引用定义在 <code>Property</code> 内部，实现注入</li>
<li>外部 Bean<br>在外部创建一个bean对象，通过ref属性引用外部对象，值为外部对象的id</li>
<li>级联赋值<br>通过给对象提供 <code>Getter</code> 方法，通过对象.属性的方式进行赋值</li>
<li>外部对象集合注入<br>通过 util 工具，将对象集合在外部定义好，通过ref属性进行引用</li>
</ul>
<p>XML 配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 7.注入对象属性 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 内部Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connect"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"connect"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemoConnect"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectCode"</span> <span class="attr">value</span>=<span class="string">"00000"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectString"</span> <span class="attr">value</span>=<span class="string">"11111"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 外部Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"outDemo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connect"</span> <span class="attr">ref</span>=<span class="string">"outConnect"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"outConnect"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemoConnect"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectCode"</span> <span class="attr">value</span>=<span class="string">"00001"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectString"</span> <span class="attr">value</span>=<span class="string">"22222"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 级联赋值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"linkDemo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connect"</span> <span class="attr">ref</span>=<span class="string">"linkConnect"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connect.connectCode"</span> <span class="attr">value</span>=<span class="string">"00002"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connect.connectString"</span> <span class="attr">value</span>=<span class="string">"33333"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"linkConnect"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemoConnect"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 对象集合注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"listDemo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connects"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"outConnect"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"linkConnect"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 抽取对象集合部分 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"listDemoUtil"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connects"</span> <span class="attr">ref</span>=<span class="string">"connectList"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 以下的外部注入方式会生成一个集合对象，可以在容器中通过getBean的方式获取 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">"connectList"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"linkConnect"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"outConnect"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBeanWired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.通过资源文件获取实现，解析 XML 配置文件</span></span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean-config.xml"</span>);</span><br><span class="line">    <span class="comment">// 2.调用getBean方法获取实例，demo为配置文件中配置的示例标识id</span></span><br><span class="line">    BeanDemo bean = context.getBean(<span class="string">"demo"</span>, BeanDemo.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 内置 bean 注入</span></span><br><span class="line">    <span class="comment">// class com.practice.entity.BeanDemoConnect&#123;connectCode=00000, connectString=11111&#125;</span></span><br><span class="line">    System.out.println(bean.getConnect());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 需要注意，外部bean注入及级联赋值的方式无法引用内置bean方式创建的关联对象</span></span><br><span class="line">    <span class="comment">// 外部 bean 注入</span></span><br><span class="line">    <span class="comment">// class com.practice.entity.BeanDemoConnect&#123;connectCode=00001, connectString=22222&#125;</span></span><br><span class="line">    BeanDemo outDemo = context.getBean(<span class="string">"outDemo"</span>, BeanDemo.class);</span><br><span class="line">    System.out.println(outDemo.getConnect());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 级联赋值</span></span><br><span class="line">    <span class="comment">// class com.practice.entity.BeanDemoConnect&#123;connectCode=00002, connectString=33333&#125;</span></span><br><span class="line">    BeanDemo linkDemo = context.getBean(<span class="string">"linkDemo"</span>, BeanDemo.class);</span><br><span class="line">    System.out.println(linkDemo.getConnect());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 内置对象集合注入</span></span><br><span class="line">    <span class="comment">//[class com.practice.entity.BeanDemoConnect&#123;connectCode=00001, connectString=22222&#125;,</span></span><br><span class="line">    <span class="comment">// class com.practice.entity.BeanDemoConnect&#123;connectCode=00002, connectString=33333&#125;]</span></span><br><span class="line">    BeanDemo listDemo = context.getBean(<span class="string">"listDemo"</span>, BeanDemo.class);</span><br><span class="line">    System.out.println(listDemo.getConnects());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抽取对象集合，外部注入(倒序输出)</span></span><br><span class="line">    <span class="comment">// [class com.practice.entity.BeanDemoConnect&#123;connectCode=00002, connectString=33333&#125;,</span></span><br><span class="line">    <span class="comment">// class com.practice.entity.BeanDemoConnect&#123;connectCode=00001, connectString=22222&#125;]</span></span><br><span class="line">    List connectList = context.getBean(<span class="string">"connectList"</span>, List.class);</span><br><span class="line">    System.out.println(connectList);</span><br><span class="line">    BeanDemo listDemoUtil = context.getBean(<span class="string">"listDemoUtil"</span>, BeanDemo.class);</span><br><span class="line">    System.out.println(listDemoUtil.getConnects());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="FacatoryBean-lt-T-gt"><a href="#FacatoryBean-lt-T-gt" class="headerlink" title="FacatoryBean&lt;T&gt;"></a>FacatoryBean&lt;T&gt;</h5><p>配置一个工厂Bean<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * XML 配置的工厂Bean</span></span><br><span class="line"><span class="comment"> * 不指定泛型时，默认返回一个 Object 对象</span></span><br><span class="line"><span class="comment"> * 指定具体的泛型，则返回具体类型的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactoryDemo</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">BeanDemo</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanDemo <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BeanDemo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> BeanDemo.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>XML 配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- BeanFactoryDemo 为FactoryBean&lt;BeanDemo&gt;的实现，此处创建的应该是BeanDemo的实例 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.practice.factory.BeanFactoryDemo"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFactoryBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 测试工厂Bean及普通Bean区别</span></span><br><span class="line">    <span class="comment">// 普通的bean定义是XML中配置什么类型就接收什么类型</span></span><br><span class="line">    <span class="comment">// 而通过实现FactoryBean&lt;T&gt; 接口可以达到配置实现类的bean，可以指定其返回值类型</span></span><br><span class="line"></span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean-config.xml"</span>);</span><br><span class="line">    <span class="comment">// FactoryBean指定泛型后需要使用指定的类型或其超类去接收</span></span><br><span class="line">    BeanDemo bean = context.getBean(<span class="string">"demo"</span>, BeanDemo.class);</span><br><span class="line">    <span class="comment">// class com.practice.entity.BeanDemo</span></span><br><span class="line">    <span class="comment">// &#123;demoCode=null, demoString=null, demoSize=null, demoBool=false, demoList=null, demoMap=null, demoArray=null, connect=null, connects=null&#125;</span></span><br><span class="line">    System.out.println(bean);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>需要注意，以普通对象创建的方式去接收工厂实现，会报错：BeanNotOfRequiredTypeException<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BeanFactoryDemo bean = context.getBean(&quot;demo&quot;, BeanFactoryDemo.class);</span><br><span class="line">Bean named &apos;demo&apos; is expected to be of type &apos;com.practice.factory.BeanFactoryDemo&apos; </span><br><span class="line">but was actually of type &apos;com.practice.entity.BeanDemo&apos;</span><br></pre></td></tr></table></figure></p>
<h3 id="XML-amp-注解实现对象管理"><a href="#XML-amp-注解实现对象管理" class="headerlink" title="XML &amp; 注解实现对象管理"></a>XML &amp; 注解实现对象管理</h3><p>通过XML配置，再结合注解实现对象管理，包括XML自动注入，及通过XML开启组件扫描，实现对象的加载及属性注入。</p>
<h4 id="XML-配置自动注入"><a href="#XML-配置自动注入" class="headerlink" title="XML 配置自动注入"></a>XML 配置自动注入</h4><p>基础的 XML 配置中实现属性注入，我们是通过将属性名和对象进行关联，达到对象的注入，自动注入的方式方式，通过</p>
<p>XML 配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    1.基于xml配置实现对象自动注入</span></span><br><span class="line"><span class="comment">        byName: 依据属性名进行注入，会匹配与属性名称相同的对象</span></span><br><span class="line"><span class="comment">        byType: 依据类型注入，匹配与属性值类型相同的对象进行注入</span></span><br><span class="line"><span class="comment">        需要注意：byType，如果定义两个属性相同类型的对象，通过类型匹配是会报错：UnsatisfiedDependencyException，NoUniqueBeanDefinitionException</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemoXML"</span> <span class="attr">autowire</span>=<span class="string">"byType"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"connect"</span> <span class="attr">class</span>=<span class="string">"com.practice.entity.BeanDemoConnect"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;bean id="demoConnect" class="com.practice.entity.BeanDemoConnect"/&gt;--&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.通过资源文件获取实现，解析 XML 配置文件</span></span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean-config-more.xml"</span>);</span><br><span class="line">    <span class="comment">// 2.使用xml的自动装配功能，实现属性注入</span></span><br><span class="line">    BeanDemoXML bean = context.getBean(<span class="string">"demo"</span>, BeanDemoXML.class);</span><br><span class="line">    System.out.println(bean);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * 配置bean标签的 autowire 属性实现自动注入</span></span><br><span class="line"><span class="comment">        * 1.byName:</span></span><br><span class="line"><span class="comment">        * 依据属性名进行注入，会匹配与属性名称相同的对象</span></span><br><span class="line"><span class="comment">        * 属性名相同，则无法注入对象如下，定义 id="connect"，BeanDemoConnect的实例不为null</span></span><br><span class="line"><span class="comment">        * class com.practice.entity.BeanDemoAnnotation &#123;connect=class com.practice.entity.BeanDemoConnect&#123;connectCode=null, connectString=null&#125;&#125;</span></span><br><span class="line"><span class="comment">        *</span></span><br><span class="line"><span class="comment">        * 属性名不同，则无法注入对象如下，定义 id="demoConnect"</span></span><br><span class="line"><span class="comment">        * class com.practice.entity.BeanDemoAnnotation &#123;connect=null&#125;</span></span><br><span class="line"><span class="comment">        *</span></span><br><span class="line"><span class="comment">        * 2. byType:</span></span><br><span class="line"><span class="comment">        * 依据类型注入，匹配与属性值类型相同的对象进行注入</span></span><br><span class="line"><span class="comment">        * 无论id定义如何，结果都为：</span></span><br><span class="line"><span class="comment">        * class com.practice.entity.BeanDemoAnnotation &#123;connect=class com.practice.entity.BeanDemoConnect&#123;connectCode=null, connectString=null&#125;&#125;</span></span><br><span class="line"><span class="comment">        * </span></span><br><span class="line"><span class="comment">        * 3.constructor：</span></span><br><span class="line"><span class="comment">        * 构造参数中按类型注入，同样若存在多个对象会注入失败</span></span><br><span class="line"><span class="comment">        * </span></span><br><span class="line"><span class="comment">        * 但是，如果定义两个属性相同类型的对象，通过类型匹配是会报错：UnsatisfiedDependencyException，NoUniqueBeanDefinitionException</span></span><br><span class="line"><span class="comment">        * No qualifying bean of type 'com.practice.entity.BeanDemoConnect'</span></span><br><span class="line"><span class="comment">        * available: expected single matching bean but found 2: connect,demoConnect</span></span><br><span class="line"><span class="comment">        * 提示本应该是一个匹配的对象实例，但是却找到了两个</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="XML-配置开启组件扫描"><a href="#XML-配置开启组件扫描" class="headerlink" title="XML 配置开启组件扫描"></a>XML 配置开启组件扫描</h4><p>XML 配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    开启逐渐扫描：</span></span><br><span class="line"><span class="comment">    1.引入context命名空间</span></span><br><span class="line"><span class="comment">    2.使用component-scan扫描base-package指定包下的 @Component注解注释的类</span></span><br><span class="line"><span class="comment">    3.use-default-filters 默认为true,是否使用默认的过滤器</span></span><br><span class="line"><span class="comment">        true: 默认的配置会将所有的合适的类都加载</span></span><br><span class="line"><span class="comment">        false: 用户可以自己指定需要加载那些类型的类</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.practice"</span> <span class="attr">use-default-filters</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 组件扫描的过程中，添加需要被扫描的对象,必须在exclude-filter前定义 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 组件扫描的过程中，过滤掉不需要扫描的对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testXMLComponentScan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 验证简单的对象创建</span></span><br><span class="line">    <span class="comment">// 1.通过资源文件获取实现，解析 XML 配置文件</span></span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean-config-more.xml"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组件扫描过程中，日志中打印了实现类的实例创建信息</span></span><br><span class="line">    <span class="comment">// DEBUG org.springframework.beans.factory.support.DefaultListableBeanFactory</span></span><br><span class="line">    <span class="comment">// - Creating shared instance of singleton bean 'documentHandlerServiceImpl'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.获取组件实例</span></span><br><span class="line">    DocumentHandlerService bean = context.getBean(<span class="string">"documentInstance"</span>, DocumentHandlerService.class);</span><br><span class="line">    System.out.println(bean);</span><br><span class="line">    bean.uploadExcel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 组件扫描的过程会将所有添加了注解@Component的类都加载进容器</span></span><br><span class="line"><span class="comment">     * 常见注解有：@Controller、@RestController、@Service、@Configuration、@Repository、@Component ...</span></span><br><span class="line"><span class="comment">     * 这些注解内部都添加了@Component注解，在执行Component-scan的过程中，会被加载</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 默认的注解如果不设置具体的value值，那么创建的实例就是当前类名的首字母小写, 如 DocumentHandlerServiceImpl</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @Service</span></span><br><span class="line"><span class="comment">     * 不指定实例名,则创建的实例名就是 documentHandlerServiceImpl</span></span><br><span class="line"><span class="comment">     * 日志: Creating shared instance of singleton bean 'documentHandlerServiceImpl'</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @Service("documentInstance")</span></span><br><span class="line"><span class="comment">     * 指定实例名,则可以通过此名称获取当前类型的实例对象</span></span><br><span class="line"><span class="comment">     * 日志: Creating shared instance of singleton bean 'documentInstance'</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="纯注解实现对象管理"><a href="#纯注解实现对象管理" class="headerlink" title="纯注解实现对象管理"></a>纯注解实现对象管理</h3><p>将XML配置方式过度为纯注解的配置方式，Spring Boot使用的就是这种方式，通过 <code>ComponentScan</code> 注解扫描具体的包路径下的 <code>@Componet</code> 注解修饰的类。</p>
<p><code>@Configuration</code> 注解功能等同于 <code>bean.xml</code>，<code>@Bean</code>、<code>@Scope</code> 等注解可以实现对象的创建，其形式如同：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--创建实体实例--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">'beanInstance'</span> <span class="attr">class</span>=<span class="string">"com.xxx.xxx.BeanInstance"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>将原来的XML解析类 <code>ClassPathXmlApplicationContext</code> 换成了注解解析类 <code>AnnotationConfigApplicationContext</code></p>
<p>新增配置类，并开启组件扫描：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过注解的方式配置组件扫描</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.practice"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComponentScanConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// @Bean 等同于XML中配置&lt;bean id="" class=""/&gt;，name/value为配置的实例名，如同id</span></span><br><span class="line">    <span class="comment">// @Scope 为bean的scope属性，同样有singleton和prototype属性值，表示单例及多例对象</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"beanAnnotation"</span>)</span><br><span class="line">    <span class="meta">@Scope</span>(<span class="string">"singleton"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanDemoAnnotation <span class="title">getBeanDemoAnnotation</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BeanDemoAnnotation();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建连接对象，用于测试属性注入</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"connect"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanDemoConnect <span class="title">getBeanDemoConnect</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BeanDemoConnect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAnnotationComponentScan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取添加了@Configuration注解的配置类</span></span><br><span class="line">    AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(ComponentScanConfig.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// @Service注解修饰的实现类能够通过类型获取实例</span></span><br><span class="line">    <span class="comment">// com.practice.service.impl.DocumentHandlerServiceImpl@682c1e93</span></span><br><span class="line">    DocumentHandlerService documentInstance = context.getBean(DocumentHandlerService.class);</span><br><span class="line">    System.out.println(documentInstance);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 如果没有@Component注解相关的注解修饰，无法直接获取对象</span></span><br><span class="line"><span class="comment">     * No qualifying bean of type 'com.practice.entity.BeanDemoAnnotation' available</span></span><br><span class="line"><span class="comment">     * 在配置类中使用@Bean注释一个具有具体类型返回值的方法</span></span><br><span class="line"><span class="comment">     * 如同和XML中的bean定义类似，可以自己自定实例名，对value或name赋值如下：</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @Bean(name = "beanAnnotation")</span></span><br><span class="line"><span class="comment">     * public BeanDemoAnnotation getBeanDemoAnnotation()&#123;</span></span><br><span class="line"><span class="comment">     *    return new BeanDemoAnnotation();</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * class com.practice.entity.BeanDemoAnnotation &#123;connect=null&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BeanDemoAnnotation beanDemo = context.getBean(BeanDemoAnnotation.class);</span><br><span class="line">    System.out.println(beanDemo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><p>面向切面编程，利用AOP实现业务逻辑各个部分的隔离，从而降低各个模块之间的耦合度，提高程序的可重用性。</p>
<p>AOP和OOP的区别，在不改变框架架构的基础上，可以直接对原框架的部分功能进行增强，如在某一个操作的前后新增部分逻辑等。</p>
<h3 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h3><p>AOP的实现原理是通过动态代理的方式，达到逻辑增强的目的，主要方式有：</p>
<ul>
<li>JDK动态代理<br>基于接口的实现方式</li>
<li>CGLib动态代理<br>无接口时，通过继承的方式实现</li>
</ul>
<h4 id="JDK-动态代理"><a href="#JDK-动态代理" class="headerlink" title="JDK 动态代理"></a>JDK 动态代理</h4><p>针对存在接口的情况，若目标类实现了某个接口，创建一个代理类实现该接口，此时目标类和代理类方法一样。</p>
<p>通过Proxy实现动态代理，其中核心的实现方法为：newProxyInstance</p>
<p><strong>实现原理</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建一个代理对象实例，返回类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span>  IllegalArgumentException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span>  NullPointerException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span>  SecurityException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newProxyInstance</span><span class="params">(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IllegalArgumentException</span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 查找或生成指定的代理类。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy  代理对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method 代理方法，若需要为多个方法实现动态代理，则需要对方法进行名称判断</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args   调用方法所需的参数列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>参数类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>loader</td>
<td>ClassLoader</td>
<td>当前类加载器</td>
</tr>
<tr>
<td>interfaces</td>
<td>Class&lt;?&gt;[]</td>
<td>需要代理的接口</td>
</tr>
<tr>
<td>h</td>
<td>InvocationHandler</td>
<td>调用处理程序接口，内部通过反射的invoke方式调用对象的被代理方法，可以通过传入的参数列表进行对原代码逻辑的功能增强，如，新增验证等</td>
</tr>
</tbody>
</table>
<p>举个例子，如下的接口及实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 目标代理接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TargetProxy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(String target, <span class="keyword">boolean</span> status)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 目标代理接口实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TargetProxyImpl</span> <span class="keyword">implements</span> <span class="title">TargetProxy</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String target, <span class="keyword">boolean</span> status)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"目标代理类方法！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Proxy 实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDk动态代理实现</span></span><br><span class="line"><span class="comment"> * 基于接口的方式实现动态代理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDKProxy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object object;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JDKProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JDKProxy</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态代理实现方法逻辑增强</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt;[] interfaces = &#123;TargetProxy.class&#125;;</span><br><span class="line"></span><br><span class="line">        TargetProxy targetProxy = (TargetProxy) Proxy.newProxyInstance(getClass().getClassLoader(), interfaces, <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> proxy  代理对象</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> method 代理方法</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> args   方法参数列表</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"JDK 扩展代理前置逻辑实现！"</span>);</span><br><span class="line">                <span class="comment">// TODO 此处可自主新增逻辑</span></span><br><span class="line">                <span class="keyword">for</span> (Object arg : args) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (arg <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">                        System.out.println(arg.toString());</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arg <span class="keyword">instanceof</span> Boolean) &#123;</span><br><span class="line">                        System.out.println(Boolean.valueOf(arg.toString()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                Object result = method.invoke(object, args);</span><br><span class="line">                System.out.println(<span class="string">"JDK 扩展代理后置逻辑实现！"</span>);</span><br><span class="line">                <span class="comment">// TODO 此处可自主新增逻辑</span></span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        targetProxy.process(<span class="string">"target"</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJDKProxy</span><span class="params">()</span></span>&#123;</span><br><span class="line">    TargetProxy targetProxy = <span class="keyword">new</span> TargetProxyImpl();</span><br><span class="line">    JDKProxy jdkProxy = <span class="keyword">new</span> JDKProxy(targetProxy);</span><br><span class="line">    jdkProxy.process();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 执行结果：</span></span><br><span class="line"><span class="comment"> * JDK 扩展代理前置逻辑实现！</span></span><br><span class="line"><span class="comment"> * target</span></span><br><span class="line"><span class="comment"> * true</span></span><br><span class="line"><span class="comment"> * 目标代理类方法！</span></span><br><span class="line"><span class="comment"> * JDK 扩展代理后置逻辑实现！</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<p><strong>小插曲</strong></p>
<p>因为手贱把编译目录下的代理类字节码文件给删除了，运行测试方法的时候出现了如下错误：<code>java.lang.NoClassDefFoundError: com/example/test/demo/aspect/JDKProxy</code></p>
<p>在不修改对应类代码的情况下，虚拟机没有重新编译当前该类，导致类的字节码文件没有重新生成，在执行动态代理的过程中，无法加载类的字节码文件而报错。</p>
<p><code>NoClassDefFoundError</code> 不同于 <code>ClassNotfoundException</code> ：</p>
<ul>
<li><code>NoClassDefFoundError</code><br>发生在JVM在动态运行时，根据你提供的类名，在classpath中找到对应的类进行加载，但当它找不到这个类时，就发生了 <code>java.lang.NoClassDefFoundError</code> 的错误</li>
<li><code>ClassNotFoundException</code><br>在编译的时候在classpath中找不到对应的类而发生的错误</li>
</ul>
<h4 id="CGLib动态代理"><a href="#CGLib动态代理" class="headerlink" title="CGLib动态代理"></a>CGLib动态代理</h4><p>CGLib 动态代理不同JDK代理方式，它代理的方式主要依赖继承，通过生成目标代理类子类的代理对象达到对象方法的逻辑增强等功能。</p>
<p>如果是 <code>maven</code> 项目按下述方式引入 <code>cglib</code> 依赖：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/cglib/cglib --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>通过Proxy实现动态代理，其中核心的实现方法为：newProxyInstance</p>
<p><strong>实现原理</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这是一个帮助创建代理对象的方法，通过传入指定的参数达到目的</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 此方法有多种重载，但为了更好的控制实例的生成</span></span><br><span class="line"><span class="comment"> * 官方建议使用 &lt;code&gt;new Enhancer()&lt;/code&gt; 的方式代替次静态方法</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> superclass 类扩展或接口实现</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> interfaces 要实现的接口数组，或者为null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> callback   针对代理对象所有方法的回调</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">create</span><span class="params">(Class superclass, Class[] interfaces, Callback callback)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建一个用于增强者对象</span></span><br><span class="line">    Enhancer e = <span class="keyword">new</span> Enhancer();</span><br><span class="line">    <span class="comment">// 设置父类</span></span><br><span class="line">    e.setSuperclass(superclass);</span><br><span class="line">    <span class="comment">// 接口，可以为null</span></span><br><span class="line">    e.setInterfaces(interfaces);</span><br><span class="line">    <span class="comment">// 回调方法</span></span><br><span class="line">    e.setCallback(callback);</span><br><span class="line">    <span class="keyword">return</span> e.create();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 方法拦截接口，继承自 Callback</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MethodInterceptor</span> <span class="keyword">extends</span> <span class="title">Callback</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过方法代理对象的invokeSuper方式调用父类方法，实现方法前置后置的功能逻辑增强</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj    "this", 被增强的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method 拦截的方法/增强的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args   方法参数列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy  用于调用父类方法（非拦截方法），可以根据需要多次调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Object <span class="title">intercept</span><span class="params">(Object var1, Method var2, Object[] var3, MethodProxy var4)</span> <span class="keyword">throws</span> Throwable</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实体Bean:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 目标代理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleDemoBuilder</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"简单的建造类的 build 方法！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>代理对象：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CGLib动态代理</span></span><br><span class="line"><span class="comment"> * 基于非接口的代理实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CGLibProxy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// MethodInterceptor 方法拦截接口，父类的所有方法都会加上此拦截逻辑</span></span><br><span class="line">        SimpleDemoBuilder builder = (SimpleDemoBuilder) Enhancer.create(SimpleDemoBuilder.class, <span class="keyword">null</span>, <span class="keyword">new</span> MethodInterceptor() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> o           代理对象</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> method      代理方法</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> objects     方法参数列表</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> methodProxy 方法代理对象</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"CGLIB 扩展代理前置逻辑实现！"</span>);</span><br><span class="line">                <span class="comment">// TODO 此处可自主新增逻辑</span></span><br><span class="line">                Object result = methodProxy.invokeSuper(o, objects);</span><br><span class="line">                <span class="comment">// 如下的方法会陷入死循环</span></span><br><span class="line">                <span class="comment">// Object result = method.invoke(o, objects);</span></span><br><span class="line">                System.out.println(<span class="string">"CGLIB 扩展代理后置逻辑实现！"</span>);</span><br><span class="line">                <span class="comment">// TODO 此处可自主新增逻辑</span></span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        builder.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJDKProxy</span><span class="params">()</span></span>&#123;</span><br><span class="line">    CGLibProxy cgLibProxy = <span class="keyword">new</span> CGLibProxy();</span><br><span class="line">    cgLibProxy.process();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CGLIB 扩展代理前置逻辑实现！</span></span><br><span class="line"><span class="comment"> * 简单的建造类的 build 方法！</span></span><br><span class="line"><span class="comment"> * CGLIB 扩展代理后置逻辑实现！</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure></p>
<h3 id="AOP-术语"><a href="#AOP-术语" class="headerlink" title="AOP 术语"></a>AOP 术语</h3><p>AOP 的专业术语包括连接点、切入点、通知（增强）等。</p>
<ul>
<li>连接点<br>可以被增强的方法，称之为连接点</li>
<li>切入点<br>实际增强的方法，称之为切入点</li>
<li><p>通知（增强）<br>实际增强的逻辑部分称之为通知（增强）<br>通知的多种类型：</p>
<ul>
<li>前置通知：方法执行前增强逻辑</li>
<li>后置通知：方法执行后增强逻辑</li>
<li>环绕通知：方法前后都执行的增强逻辑</li>
<li>异常通知：抛异常后的增强逻辑</li>
<li>最终通知：最后执行的增强逻辑</li>
</ul>
</li>
<li><p>切面<br>将增强通知应用到切入点的过程</p>
</li>
</ul>
<p>想要启用AOP的相关功能需要引入相应的依赖：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.aspectj/aspectjweaver --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>举个例子，有如下接口及实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DocumentHandlerService</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">uploadExcel</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span>(<span class="string">"documentInstance"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DocumentHandlerServiceImpl</span> <span class="keyword">implements</span> <span class="title">DocumentHandlerService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadExcel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"文件上传，待实现 ......"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"res"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="基于XML配置"><a href="#基于XML配置" class="headerlink" title="基于XML配置"></a>基于XML配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 创建目标对象及增强逻辑对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"documentInstance"</span> <span class="attr">class</span>=<span class="string">"com.practice.service.impl.DocumentHandlerServiceImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"documentHandlerXML"</span> <span class="attr">class</span>=<span class="string">"com.practice.aspect.DocumentHandlerXML"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- AOP配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 切入点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"aopTest"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.practice.service.impl.DocumentHandlerServiceImpl.uploadExcel(..))"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 切面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"documentHandlerXML"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut-ref</span>=<span class="string">"aopTest"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"afterReturning"</span> <span class="attr">pointcut-ref</span>=<span class="string">"aopTest"</span> <span class="attr">returning</span>=<span class="string">"res"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"afterThrowing"</span> <span class="attr">pointcut-ref</span>=<span class="string">"aopTest"</span> <span class="attr">throwing</span>=<span class="string">"e"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"After"</span> <span class="attr">pointcut-ref</span>=<span class="string">"aopTest"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"around"</span> <span class="attr">pointcut-ref</span>=<span class="string">"aopTest"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>代理对象：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DocumentHandlerXML</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Before............前置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后置通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object res)</span></span>&#123;</span><br><span class="line">        <span class="comment">// returning 接收的参数实际是由@Around返回</span></span><br><span class="line">        System.out.println(<span class="string">"AfterReturning......后置通知, returning = "</span> + res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Around......环绕前置通知"</span>);</span><br><span class="line">        Object proceed = proceedingJoinPoint.proceed();</span><br><span class="line">        System.out.println(<span class="string">"Around......环绕后置通知"</span>);</span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">            System.out.println(exception.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"AfterThrowing......异常通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最终通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">After</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"After......最终通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="纯注解的方式"><a href="#纯注解的方式" class="headerlink" title="纯注解的方式"></a>纯注解的方式</h4><p>通过XML配置AOP自动代理：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启Spring的组件扫描 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.practice"</span> <span class="attr">use-default-filters</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 组件扫描的过程中，添加需要被扫描的对象,必须在exclude-filter前定义 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 组件扫描的过程中，过滤掉不需要扫描的对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 开启AOP自动代理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>通过在配置类上添加注解：<code>@EnableAspectJAutoProxy</code>，即，启用AOP的自动代理：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过注解的方式配置组件扫描</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.practice"</span>)</span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span> <span class="comment">//注解的方式开启AOP自动代理</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComponentScanConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>AOP切面增强逻辑：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DocumentHandlerAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 切面逻辑的切入点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(value = <span class="string">"execution(* com.practice.service.impl.DocumentHandlerServiceImpl.uploadExcel(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置通知</span></span><br><span class="line"><span class="comment">     * 在切入点方法前执行的逻辑</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before</span>(value = <span class="string">"pointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Before............前置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后置通知</span></span><br><span class="line"><span class="comment">     * 在切入点方法后执行的通知，可以接受方法返回结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning</span>(value = <span class="string">"pointCut()"</span>, returning = <span class="string">"res"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object res)</span></span>&#123;</span><br><span class="line">        <span class="comment">// returning 接收的参数实际是由@Around返回</span></span><br><span class="line">        System.out.println(<span class="string">"AfterReturning......后置通知, returning = "</span> + res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕通知</span></span><br><span class="line"><span class="comment">     * 切入点前后都可以执行自定义逻辑</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proceedingJoinPoint 切入点执行的过程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around</span>(value = <span class="string">"pointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Around......环绕前置通知"</span>);</span><br><span class="line">        Object proceed = proceedingJoinPoint.proceed();</span><br><span class="line">        System.out.println(<span class="string">"Around......环绕后置通知"</span>);</span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常通知</span></span><br><span class="line"><span class="comment">     * 当切入点方法发生异常/错误时，执行的逻辑</span></span><br><span class="line"><span class="comment">     * 可以进行异常的处理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(value = <span class="string">"pointCut()"</span>, throwing = <span class="string">"e"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">            System.out.println(exception.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"AfterThrowing......异常通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最终通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@After</span>(value = <span class="string">"pointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">After</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"After......最终通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最终实现结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">正常情况下的输出：</span><br><span class="line">Around......环绕前置通知  </span><br><span class="line">Before............前置通知  </span><br><span class="line">文件上传，待实现 ......  </span><br><span class="line">Around......环绕后置通知  </span><br><span class="line">After......最终通知  </span><br><span class="line">AfterReturning......后置通知, returning = res  </span><br><span class="line"></span><br><span class="line">存在异常/错误时的输出：</span><br><span class="line">Around......环绕前置通知</span><br><span class="line">Before............前置通知</span><br><span class="line">文件上传，待实现 ......</span><br><span class="line">After......最终通知</span><br><span class="line">AfterThrowing......异常通知</span><br></pre></td></tr></table></figure></p>
<p>通过异常结果查看器逻辑执行的操作栈，因为增强逻辑的作用对象是接口，所以实现方式使用的是JDK的动态代理：</p>
<p><img src="/images/aop-exception.PNG" alt="程序执行栈"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本章节介绍了 Spring 框架使用中的一些实现原理，包括对象管理，切面编程等</p>
<h3 id="第一个主要内容是IOC"><a href="#第一个主要内容是IOC" class="headerlink" title="第一个主要内容是IOC"></a>第一个主要内容是IOC</h3><p>IOC又称控制反转，是一种程序设计理念，旨在将对象的创建及注入方式实现一个反转，由容器进行管理，需要使用地方通过依赖注入的方式实现属性赋值。</p>
<p>实现对象创建及管理的方式有很多中，如文中提到的基于XML配置方式，纯注解的方式，以及两者结合的方式，其主要目的是解决程序编码中各对象之间的高耦合现象。</p>
<p>文中不乏有具体的测试案例，通过这些案例解释各个对象创建及注入方式的区别及可能遇到的问题。</p>
<h3 id="第二个主要内容是AOP"><a href="#第二个主要内容是AOP" class="headerlink" title="第二个主要内容是AOP"></a>第二个主要内容是AOP</h3><p>讲述AOP的实现原理，其主要使用的是对象方法的动态代理的方式，主要的实现方式有：</p>
<ul>
<li>JDK 动态代理</li>
<li>CGLib 动态代理</li>
</ul>
<p>JDk的代理方式是基于接口实现的方式，CGLib的代理方式是基于类继承的方式。</p>
<p>同样的实现方式有xml和注解的实现方式，通过具体的示例讲述，基于XML配置实现，或者通过开启spring的组件扫描和AOP的自动代理配置的实现，在所需要增强地方，通过注解的方式配置增强方式。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/源码/" rel="tag"># 源码</a>
          
            <a href="/tags/spring/" rel="tag"># spring</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/08/22/Spring_Framework/" rel="next" title="Spring 框架之初">
                <i class="fa fa-chevron-left"></i> Spring 框架之初
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/09/06/Dynamic_Programing/" rel="prev" title="DP - 动态规划">
                DP - 动态规划 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/ILogo.png" alt="Wiki">
            
              <p class="site-author-name" itemprop="name">Wiki</p>
              <p class="site-description motion-element" itemprop="description">但求每天多一点</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/littlexiaotimpro" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:littlexiaosi@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://plus.google.com/yourname" target="_blank" title="Google">
                      
                        <i class="fa fa-fw fa-google"></i></a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://hexo.bootcss.com/docs/" title="Hexo" target="_blank">Hexo</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://theme-next.iissnan.com/" title="NexT" target="_blank">NexT</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IOC"><span class="nav-number">2.</span> <span class="nav-text">IOC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#依赖注入"><span class="nav-number">2.1.</span> <span class="nav-text">依赖注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#XML-文件解析"><span class="nav-number">2.1.1.</span> <span class="nav-text">XML 文件解析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XML-实现对象管理"><span class="nav-number">2.2.</span> <span class="nav-text">XML 实现对象管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基础的Bean创建"><span class="nav-number">2.2.1.</span> <span class="nav-text">基础的Bean创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bean的作用域及生命周期"><span class="nav-number">2.2.2.</span> <span class="nav-text">Bean的作用域及生命周期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#属性注入"><span class="nav-number">2.2.3.</span> <span class="nav-text">属性注入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Setter方式注入"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">Setter方式注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#带参构造器注入"><span class="nav-number">2.2.3.2.</span> <span class="nav-text">带参构造器注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#含特殊字符的值注入"><span class="nav-number">2.2.3.3.</span> <span class="nav-text">含特殊字符的值注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#数组或集合属性注入"><span class="nav-number">2.2.3.4.</span> <span class="nav-text">数组或集合属性注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#对象属性注入"><span class="nav-number">2.2.3.5.</span> <span class="nav-text">对象属性注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#FacatoryBean-lt-T-gt"><span class="nav-number">2.2.3.6.</span> <span class="nav-text">FacatoryBean&lt;T&gt;</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XML-amp-注解实现对象管理"><span class="nav-number">2.3.</span> <span class="nav-text">XML &amp; 注解实现对象管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#XML-配置自动注入"><span class="nav-number">2.3.1.</span> <span class="nav-text">XML 配置自动注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XML-配置开启组件扫描"><span class="nav-number">2.3.2.</span> <span class="nav-text">XML 配置开启组件扫描</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#纯注解实现对象管理"><span class="nav-number">2.4.</span> <span class="nav-text">纯注解实现对象管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AOP"><span class="nav-number">3.</span> <span class="nav-text">AOP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#动态代理"><span class="nav-number">3.1.</span> <span class="nav-text">动态代理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JDK-动态代理"><span class="nav-number">3.1.1.</span> <span class="nav-text">JDK 动态代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CGLib动态代理"><span class="nav-number">3.1.2.</span> <span class="nav-text">CGLib动态代理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOP-术语"><span class="nav-number">3.2.</span> <span class="nav-text">AOP 术语</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基于XML配置"><span class="nav-number">3.2.1.</span> <span class="nav-text">基于XML配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#纯注解的方式"><span class="nav-number">3.2.2.</span> <span class="nav-text">纯注解的方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#第一个主要内容是IOC"><span class="nav-number">4.1.</span> <span class="nav-text">第一个主要内容是IOC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第二个主要内容是AOP"><span class="nav-number">4.2.</span> <span class="nav-text">第二个主要内容是AOP</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wiki</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
